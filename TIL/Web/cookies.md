# Cookies

- small datas stored in the browser set by the web-server response using `Set-Cookie` http header

- server response &rarr; `Set-Cookie` &rarr; browser saves the cookie mapped to the domain &rarr; browser attaches the cookie to the request of the same domain

- authentication example
  - sign in to `auth.com` &rarr;
  - &larr; `Set-Cookie: ${session_identifier}`
  - request to `auth.com`, attach `Cookie: ${session_identifier}` &rarr;
  - &larr; authorizes the `${session_identifier}`

## Cookie Options

- `path`
  - `path=/page` - cookie accessble from specific `/page`
  - `path=/` - cookie accessible from all pages
- `domain`
  - `domain=site.com` - the domain where the cookie is accessible (includes sub-domain)

```js
// domain.com
document.cookie = 'user=Yoman; domain=domain.com';

// subdomain.domain.com
console.log(document.cookie); // user=Yoman is accessible
```

- `expires`, `max-age` - cookie expiration date

  - default(no declaration) - _session cookies_; cookie disappears when the browser is closed

- `secure` - cookie allowed only over HTTPS

  - cookie does not appear in HTTP

- `samesite` - protect CSRF
  - CSRF scenario
    1.  user logged into `bank.com` (browser has the authentication cookie)
    2.  user goes to forgery site `evil.com`, which has JS code that submits `<form action="https://bank.com/pay?to=hacker&amount=3000">`
    3.  browser sends authentication cookie along with dangerous query parameters to `bank.com` when the form is submitted from `evil.com`
  - _CSRF protection token_
    - all forms generated by `bank.com` have _CSRF protection token_ field, which cannot be generated from a remote page
    - `bank.com` checks for the token
  - `samesite` cookie option
    - `samtesite=strict || ''` - allow only same-site
      - cookie is never sent if the user comes from an external src
    - `samesite=lax`
      - sent if `GET` && top-level navigtaions
- `httpOnly` - JS not allowed to set or access the cookie
