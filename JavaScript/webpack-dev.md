# Webpack Development Process


## Introduction

* setup
```
npm install --save-dev webpack webpack-cli
```

* `package.json` - default setup
```json
{
  "private": true, // do not publish the app
  "scripts": {
    "start": "webpack"
  },
}
```
```bash
npm start
...
ERROR in Entry module not found: Error: Can't resolve './src' in 'C:\...'
```
* need to provide a default directory or `src/app/index.js` file

* `src/app/index.js` - the default *to-be-bundled* file
```javascript
alert("show this message");
```
```bash
npm start
...
Entrypoint main = main.js
WARNING in configuration
The 'mode' option has not been set, webpack will fallback to 'production' for this value. Set 'mode' option to 'development' or 'production' to enable defaults for each environment.
```
* notice `dist/main.js`(*the distribution file*) has been created
* the `dist/main.js` is the ditribution file that has bundled all the javascript codes from `src/app/index.js` that are integrated *in order*

* `./index.html` - html entry
```html
<html>
  ...
  <script src="./dist/main.js"></script>
</html>
```
* when browsing the `./index.html` the wrapped `src/app/index.js` will be executed by `dist/main.js`


## Basic Configuration
> configuration setting in `webpack.config.js`

* set config file
```json
// package.json
{
  "scripts": {
    "start": "webpack --config webpack.config.json" // set config file
  },
}
```

* **default mode** (production)
```javascript
// webpack.config.js
const path = require("path");
module.exports = {
  // the to-be-bundled JS file
  entry: "./src/index.js",
  // make a bundled file `C:/.../webpack-demo-app/[dist]/[main.js]`
  output: {
    filename: "main.js",
    path: path.resolve(__dirname, "dist")
  },
};
```

* **development mode**
```javascript
// webpack.config.js
module.exports = {
  // set mode to development
  mode: "development",
};
```
* the production mode bundles the file without obfuscation - easier to debug

* `devtool` controls the `eval` codes
```javascript
module.exports = {
  devtool: "none",
}
```


## Loaders
> pre-process with certain rules

### CSS
```bash
npm install --save-dev style-loader css-loader
```

* `css-loader` turns *CSS* to valid *JS*
* `style-loader` adds CSS(from valid JS) to the DOM by injecting a `<style>` tag
```javascript
// webpack.config.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/, // regEx: end with `.css`
        use: [
          "style-loader", // 2. Inject styles into DOM
          "css-loader" // 1. CSS to common JS
        ],
      },
    ],
  },
}
```

* **order**: `css-loader` &rarr; `style-loader`; `Array.pop`


### SASS
* `css-loader` not compatible with `/\.scss$/`; *SASS(SCSS)* needs to be compiled to be *CSS*
```bash
npm install --save-dev sass-loader node-sass
```
```javascript
// webpack.config.js
test: /\.scss$/,
use: [
  "style-loader", // 3. Inject styles into DOM
  "css-loader", // 2. CSS to common JS
  "sass-loader" // 1. SASS to CSS
]
```


## Cache Busting
> prevent browsers from caching bundled files (prevent `served from disk cache`)\
* user might use older version of distributed files when cached

* new hashed (*md5* algorithm) filename on code change - `[contentHash]`
```javascript
// webpack.config.js
module.exports = {
  output: {
    filename: "main.[contentHash].js" // hased filename
  }
}
```

* **tips**
  - `vendor.js` for unchanged libary files for caching
  - `[contentHash].js` for capricious application files




## Plugins
> additional functionality to Webpack

* `HtmlWebpackPlugin` - helper for html generation
```bash
npm install --save-dev html-webpack-plugin
```

* link dynamic filename to *HTML*
```javascript
// webpack.config.js
module.exports = {
  plugins: [new HtmlWebpackPlugin()],
}
```

```bash
npm start
```
* notice the *minimal* `dist/index.html` has been generated by `HtmlWebpackPlugin`
```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Webpack App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"></head>
  <body>
  <!-- the script has automatically been inserted -->
  <script src="main.ac07152a66a64c6d63e4.js"></script></body>
</html>
```

* provide a template(`./src/template.html`) for `HtmlWebpackPlugin`
```javascript
// webpack.config.js
plugins: [new HtmlWebpackPlugin({
  template: "./src/template.html"
})],
```
* provided information will be inserted into the template